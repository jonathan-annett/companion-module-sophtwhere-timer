function openLongPollPoster(n,e,o){n=n||0;const i="/msg-poll";let t=!1,r=[];if("function"==typeof e&&r.push(e),o){var s=e;let o={on:f,send:function o(n,e,t){if(c)c.send(n),setTimeout(e,10,void 0,!t);else{if(t&&10<=t)return e?e(new Error("could not send")):location.replace(location.href);setTimeout(o,500,n,e,(t||0)+1)}},lastId:n},c;return function n(){c=new WebSocket(location.origin.replace("http://","ws://"));c.onopen=function(o){r.forEach(function(o){o({cmd:"opened"})})};c.onmessage=function(o){const n=o.data;try{const e=JSON.parse(n);r.forEach(function(o){o(e)})}catch(n){r.forEach(function(o){o({error:n})})}};c.onclose=function(o){o.wasClean,c&&(c.onerror=void 0,c.onclose=void 0,c.onmessage=void 0,c=void 0,setTimeout(n,1500))};c.onerror=function(o){s(o),c&&(c.onerror=void 0,c.onclose=void 0,c.onmessage=void 0,c=void 0,setTimeout(n,1500))}}(),o}{let c={on:f,send:function(o,n){function e(o){return o.error?n(new Error(o.error)):o.success?n?n():void 0:void location.replace(location.href)}function t(o){if(n)return n(o)}fetch(i,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({send:o})}).then(function(o){o.json().then(e).catch(t)}).catch(t)},lastId:n};return function e(){if(!t)return setTimeout(function(){r.forEach(function(o){o({cmd:"opened"})}),t=!0,e()},100);u(function(o,n){n&&n.forEach(function(o){const n=JSON.parse(o.msg);r.forEach(function(o){o(n)})}),o&&(console.log("error in longpoll:",o),t=!1),e()})}(),c;function f(o,n){"message"===o&&"function"==typeof n&&r.push(n)}function u(n){function e(o){o.messages?(c.lastId=o.id,n(void 0,o.messages)):o.error&&n(o.error)}function t(o){n(o)}fetch(i,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({receive:c.lastId})}).then(function(o){o.json().then(e).catch(t)}).catch(t)}}}function getLongPollPosterMode(){return new Promise(function(n){function e(){t("error")}function t(o){n(o)}fetch("/msg-poll-mode.json",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({})}).then(function(o){o.json().then(t).catch(e)}).catch(e)})}