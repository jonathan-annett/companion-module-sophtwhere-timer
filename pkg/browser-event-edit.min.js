const instance_type="companion-module-sophtwhere-timer",HTTP_PORT=8088,itst_label="timer",idsUsed={};function makeRandomId(e){var t="wLWooZRJQAxsy11IcwgPY".length;let n="";for(;n.length<t;)n+=Math.random().toString(36).substring(2);return n=n.substring(0,t),idsUsed[e]=n}function makeControls(n,i,r){let s={};var e=[2,3,4,5,10,11,12,13,18,19,20,21].slice(0,r.length).map(function(e,t){return{id:`bank:${i}-`+e,data:r[t]}});return s[`bank:${i}-1`]={type:"pageup"},e.forEach(function(e,t){switch(t){case 4:s[`bank:${i}-9`]={type:"pagenum"};break;case 8:s[`bank:${i}-17`]={type:"pagedown"}}s[e.id]=buttonObj(n,e.id,e.data)}),e.length<5&&(s[`bank:${i}-9`]={type:"pagenum"}),e.length<9&&(s[`bank:${i}-17`]={type:"pagedown"}),s}function makeInstance(e,t){return{instance_type:instance_type,label:t,isFirstInit:!1,config:{port:String(e)},lastUpgradeIndex:-1,enabled:!0}}function buttonObj(e,t,{buttonText:n,displayText:i,milliseconds:r}){return{type:"button",style:{text:n,size:"14",png:null,alignment:"center:center",pngalignment:"center:center",color:16777215,bgcolor:0,show_topbar:"default"},options:{relativeDelay:!1,stepAutoProgress:!0},feedbacks:[],steps:{0:{action_sets:{down:[{id:makeRandomId(t+"-1"),action:"customMessage",instance:e,options:{text:i},delay:0},{id:makeRandomId(t+"-2"),action:"startNew",instance:e,options:{days:0,hours:0,mins:10,secs:0,msecs:r.toString()},delay:0}],up:[]},options:{runWhileHeld:[]}}}}}function makePageExport(e,t,n,i,r){var s=makeRandomId("inst"),e={version:3,type:"page",controls:makeControls(s,i,e),page:{name:r},instances:{}};return e.instances[s]=makeInstance(t,n),e.oldPageNumber=i,e}function makePagesExport(e,t,n,i){if(Object.keys(idsUsed).forEach(function(e){delete idsUsed[e]}),e.length<=12)return makePageExport(e,t,n,1,i||"PAGE");var r={version:3,type:"full",controls:{},pages:{},instances:{}};let s=1;const a=e.slice();for(var o=makeRandomId("inst");0<a.length;){var l=a.splice(0,12);if(0<l.length){const u=makeControls(o,s,l);Object.keys(u).forEach(function(e){a.controls[e]=u[e]}),r.pages[s.toString()]={name:i?i+" #"+s:"PAGE"},s++}}return a.instances[o]=makeInstance(t,n),a}function getLinesData(e,o,l){var t="-------------------------------------------------------",n=["Start                                 End     Item","Time  Display Text                    Time    Duration",t],e=e.trim().split("\n").map(function(e){return e.trim()});let s=e.map(function(e,t,n){e=e.trim().replace(/\t/g," ").replace(/\|.*$/,"").trim();for(;0<=e.indexOf("  ");)e=e.replace(/\ \ /g," ");var i=e.split(" "),r=i.shift(),i=i.join(" ").trim();if(""===i&&t<n.length-1)return null;t=r.split(":");if(2!=t.length)return null;var[n,s]=t.map(function(e){return Number.parseInt(e)});if(isNaN(n)||isNaN(s))return null;if(23<n||n<0)return null;if(59<s||s<0)return null;s+=60*n;return{startTime:s,eventText:i,line:e,timeStr:r,hours_mins:t}}).filter(r);const u=e.slice();if(0<s.length){let r=0;var i=s.map(function(e,t,n){if(0===t)return{dayMins:r,startTime:e.startTime,eventText:e.eventText,timeStr:e.timeStr};let i=r+e.startTime;return r+n[t-1].startTime>i&&e.startTime<720&&(r+=1440,i+=1440),{dayMins:r,startTime:i,eventText:e.eventText,timeStr:e.timeStr}}).map(function(e,t,n){var n=t===s.length-1?o:n[t+1].startTime-e.startTime,t=60*n,i=1e3*t,r=local24HourTime(new Date(Date.prototype.setHours.apply(new Date,(e.timeStr+":00").split(":"))+i)).split(":").splice(0,2).join(":");return{buttonText:`${o=n} mins\\n${e.eventText.replace(/^Dr\s|^Mr\s|^Ms\s|^Mrs\s|^Prof\s/gi,"").replace(/\s/g,"").substring(0,10).trim()}\\n@${e.timeStr}:00`,displayText:e.eventText,milliseconds:i,eventMins:n,eventSecs:t,startTime:e.timeStr,endTime:r}}).filter(function(e){return null!==e&&0<e.displayText.length});return document.body.className="rules1",{data:i,json:makePagesExport(i,HTTP_PORT,itst_label),parsed:u,info:n.concat(i.map(function(e){return`${e.startTime} ${e.displayText.padEnd(30)} | ${e.endTime} | ${e.eventMins} mins`}),[t])}}u.splice(0,u.length),l||(l=new Date,console.log("time now is",l),l.setMinutes(0),l.setSeconds(0),l.setTime(l.getTime()+36e5),console.log("set default time of",l),u.push(local24HourTime(l).split(":").splice(0,2).join(":")));let c=!0;i=e.map(function(e){var t=local24HourTime(l);e=e.trim().replace(/\t/g," ").replace(/\|.*$/,"").trim();for(;0<=e.indexOf("  ");)e=e.replace(/\ \ /g," ");var n=e.split(" "),i=n[0].split(":");let r=o;if(2===i.length){var[i,s]=i.map(function(e){return Number.parseInt(e)});if(isNaN(i)||isNaN(s))return null;if(23<i||i<0)return null;if(59<s||s<0)return null;(l=new Date).setHours(i,s,0),c&&(u.splice(0,u.length),c=!1)}else r=Number.parseInt(n[n.length-1]);isNaN(r)?r=o:n.pop();i=n.join(" ");if(u.push(e.trim()),""===i)return o=r,null;c=!1;var s=60*r,n=1e3*s,a=(l.setTime(l.getTime()+n),local24HourTime(l).split(":").splice(0,2).join(":"));return{buttonText:`${r} mins\\n${i.replace(/^Dr\s|^Mr\s|^Ms\s|^Mrs\s|^Prof\s/gi,"").replace(/\s/g,"").substring(0,10).trim()}\\n@`+t,displayText:i,milliseconds:n,eventMins:r,eventSecs:s,startTime:t.split(":").splice(0,2).join(":"),endTime:a}}).filter(r);return document.body.className=0===i.length?"":"rules2",{data:i,json:makePagesExport(i,HTTP_PORT,itst_label),parsed:u.filter(function(e){return 0<e.length}),info:n.concat(i.map(function(e){return`${e.startTime} ${e.displayText.padEnd(30)} | ${e.endTime} | ${e.eventMins} mins`}),[t])};function r(e){return null!==e}}const textarea=document.querySelector("textarea");function secToStr(e){var t=e<0?"-":"",n=(e<0&&(e=0-e),Math.trunc(e/60)%60),i=Math.trunc(e/3600),e=Math.trunc(e%60),e=(e<10?"0":"")+e.toString();return i<1?t+n.toString()+":"+e:(n=(n<10?"0":"")+n.toString(),t+i.toString()+":"+n+":"+e)}function local24HourTime(e){e=e.toString().split(":");return e[0]=e[0].split(" ").pop(),e[2]=e[2].split(" ")[0],e.join(":")}textarea.oninput=function(){const s=getLinesData(textarea.value,30);document.querySelector("#out").innerHTML=s.info.join("\n"),document.querySelector("button").onclick=function(){var e=new Date,[e,t,n,i,r]=[e.getFullYear(),e.getMonth(),e.getDate(),e.getHours(),e.getMinutes()];saveAs(new Blob([JSON.stringify(s.json,void 0,4)],{type:"application/json;charset=utf-8"}),`timer-custom-config_${e}${t}${n}-${i}${r}.companionconfig`)}},textarea.oninput();