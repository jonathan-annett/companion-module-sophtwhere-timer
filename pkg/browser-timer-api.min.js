function processTimerApiMessage(e,t,o,r){switch(console.log(e,t,o,r),t){case"keys":o.keys.forEach(function(e){e.startsWith("~")?onDocKeyUp({key:e.substring(1),preventDefault:function(){}}):onDocKeyDown({key:e,preventDefault:function(){}})});break;case"adjust":o.addtime?bumpEnd(o.msecs,o.msecs):bumpEnd(0-o.msecs,0-o.msecs),durationDisp.textContent=secToStr((seekEndsAt-startedAt)/1e3),displayUpdate();break;case"nudge":o.addtime?bumpEnd(o.msecs,0):bumpEnd(0-o.msecs,0),durationDisp.textContent=secToStr((seekEndsAt-startedAt)/1e3),displayUpdate();break;case"customMessage":html.classList.remove("edit_custom_message"),html.classList.remove("show_custom_message"),custom_message.innerText=o.text.trim(),custom_message.contentEditable=!1,0<custom_message.innerText.length&&html.classList.add("show_custom_message"),localStorage.setItem("custom_message",custom_message.innerText);break;case"setTimerColor":setCustomColor(o.name,o.color);break;case"setTimerColors":setCustomColors(o.colors);break;case"getTimerColor":if(timerAPI&&o.name){const o={setTimerColors:{}};var s=getCustomColor(o.name);s&&(o.setTimerColors[o.name]=s,timerAPI.send(o))}break;case"getTimerColors":getTimerColors();break;case"redirect":"number"==typeof o.url&&((s=new URL(location.href)).port=o.url.toString(),o.url=s.toString()),o.url&&(o.url.startsWith("/")||o.url.startsWith(location.origin.replace(/\:.*$/,"")))&&o.url!==location.href&&(o.delay?setTimeout(function(){location.replace(o.url)},o.delay):location.replace(o.url));break;case"presenter":"presenter"!==runMode&&location.replace("/?presenter");break;case"control":"presenter"===runMode&&location.replace("/");break;case"opened":timerAPI&&(console.log("sending startup values",dispNextMins.textContent),s=pausedAt?Date.now()-pausedAt:0,timerAPI.send({setVariableValues:{default:secToStr(defaultDuration/1e3),endsAt:endsDisp.textContent,startedAt:startedDisp.textContent,showtimenow:localStorage.getItem("showtimenow")||"0",showbar:localStorage.getItem("showbar")||"0",showmessages:localStorage.getItem("showmessages")||"0",paused:secToStr(s/1e3),pauses:secToStr((s+pauseAcum)/1e3)}}),lastTimeText="",togglePIPMode&&(togglePIPMode.lastContent=""),getTimerColors())}}function getHexColor(e){if(getHexColor.cache){if(void 0!==getHexColor.cache[e])return getHexColor.cache[e]}else getHexColor.cache={};var t=document.createElement("div"),o=(t.style.color=e,window.getComputedStyle(document.body.appendChild(t)).color.match(/\d+/g).map(function(e){return parseInt(e,10)}));return document.body.removeChild(t),getHexColor.cache[e]=3<=o.length&&"#"+((1<<24)+(o[0]<<16)+(o[1]<<8)+o[2]).toString(16).substr(1),getHexColor.cache[e]}function getTimerColors(){if(timerAPI){const n={setTimerColors:{}};let s=!1;(n.names||getCustomColorNames()).forEach(function(e){var t=getCustomColor(e),o=getHexColor(t),r=w3color(t).toName();t&&(n.setTimerColors[e]={color:t,hexColor:o,colorName:r},s=!0)}),s&&timerAPI.send(n)}}function setCustomColor(e,t,o){var r=getCustomColor(e);return""===r?null:r!==t&&(document.documentElement.style.setProperty("--color-"+e,t),!1!==o&&timerAPI&&((o={setTimerColors:{}}).setTimerColors[e]=t,timerAPI.send(o)),r)}function getCustomColorNames(){return Array.from(document.styleSheets).filter(function(e){return null===e.href||e.href.startsWith(window.location.origin)}).reduce(function(e,t){return[...e,...Array.from(t.cssRules).reduce(function(e,t){return":root"===t.selectorText?[...e,...Array.from(t.style).filter(function(e){return e.startsWith("--")})]:e},[])]},[]).map(function(e){return e.replace(/^--color-/,"")})}function getCustomColors(e){const t={};return(e||getCustomColorNames()).forEach(function(e){t[e]=getCustomColor(e)}),t}function setCustomColors(r,e){const s={},n=!(!1===e||!timerAPI)&&{setTimerColors:{}};let a=!1;return Object.keys(r).forEach(function(e){var t=r[e],o=setCustomColor(e,t,!1);o&&(s[e]=o,n)&&(n.setTimerColors[e]=t,a=!0)}),a&&timerAPI.send(n),s}function getCustomColor(e){return window.getComputedStyle(document.documentElement).getPropertyValue("--color-"+e)}