function processTimerApiMessage(e){var t=e["cmd"];switch(t.toLowerCase()){case"start":restartTimer(e.msecs);break;case"default":setDefaultDuration(e.msecs);break;case"pause":tabCount=getTabCount(),nudgeFactor=1e3,endDelta=0,seekEndDelta=1e3,onKey_Pause(),controlling=!1,html.classList[controlling?"add":"remove"]("controlling"),shifting=!1,html.classList[shifting?"add":"remove"]("shifting");break;case"undopause":onKey_UndoPause();break;case"keys":e.keys.forEach(function(e){e.startsWith("~")?onDocKeyUp({key:e.substring(1),preventDefault:function(){}}):onDocKeyDown({key:e,preventDefault:function(){}})});break;case"adjust":e.addtime?bumpEnd(e.msecs,e.msecs):bumpEnd(0-e.msecs,0-e.msecs),durationDisp.textContent=secToStr((seekEndsAt-startedAt)/1e3),displayUpdate();break;case"nudge":e.addtime?bumpEnd(e.msecs,0):bumpEnd(0-e.msecs,0),durationDisp.textContent=secToStr((seekEndsAt-startedAt)/1e3),displayUpdate();break;case"custommessage":html.classList.remove("edit_custom_message"),html.classList.remove("show_custom_message"),custom_message.innerText=e.text.trim(),custom_message.contentEditable=!1,0<custom_message.innerText.length&&html.classList.add("show_custom_message"),localStorage.setItem("custom_message",custom_message.innerText);break;case"settimercolor":setCustomColor(e.name,e.color);break;case"settimercolors":setCustomColors(e.colors);break;case"gettimercolor":if(timerAPI&&e.name){const e={setTimerColors:{}};var o=getCustomColor(e.name);o&&(e.setTimerColors[e.name]=o,timerAPI.send(e))}break;case"gettimercolors":getTimerColors();break;case"redirect":"number"==typeof e.url&&((o=new URL(location.href)).port=e.url.toString(),e.url=o.toString()),e.url&&(e.url.startsWith("/")||e.url.startsWith(location.origin.replace(/\:.*$/,"")))&&e.url!==location.href&&(e.delay?setTimeout(function(){location.replace(e.url)},e.delay):location.replace(e.url));break;case"presenter":"presenter"!==runMode&&location.replace("/?presenter");break;case"control":"presenter"===runMode&&location.replace("/");break;case"opened":timerAPI&&(console.log("sending startup values",dispNextMins.textContent),o=pausedAt?Date.now()-pausedAt:0,timerAPI.send({setVariableValues:{default:secToStr(defaultDuration/1e3),endsAt:endsDisp.textContent,startedAt:startedDisp.textContent,showtimenow:localStorage.getItem("showtimenow")||"0",showbar:localStorage.getItem("showbar")||"0",showmessages:localStorage.getItem("showmessages")||"0",paused:secToStr(o/1e3),pauses:secToStr((o+pauseAcum)/1e3)}}),lastTimeText="",togglePIPMode&&(togglePIPMode.lastContent=""),getTimerColors())}}function getHexColor(e){if(getHexColor.cache){if(void 0!==getHexColor.cache[e])return getHexColor.cache[e]}else getHexColor.cache={};var t=document.createElement("div"),o=(t.style.color=e,window.getComputedStyle(document.body.appendChild(t)).color.match(/\d+/g).map(function(e){return parseInt(e,10)}));return document.body.removeChild(t),getHexColor.cache[e]=3<=o.length&&"#"+((1<<24)+(o[0]<<16)+(o[1]<<8)+o[2]).toString(16).substr(1),getHexColor.cache[e]}function getTimerColors(){if(timerAPI){const n={setTimerColors:{}};let r=!1;(n.names||getCustomColorNames()).forEach(function(e){var t=getCustomColor(e),o=getHexColor(t),s=w3color(t).toName();t&&(n.setTimerColors[e]={color:t,hexColor:o,colorName:s},r=!0)}),r&&timerAPI.send(n)}}function setCustomColor(e,t,o){var s=getCustomColor(e);return""===s?null:s!==t&&(document.documentElement.style.setProperty("--color-"+e,t),!1!==o&&timerAPI&&((o={setTimerColors:{}}).setTimerColors[e]=t,timerAPI.send(o)),s)}function getCustomColorNames(){return Array.from(document.styleSheets).filter(function(e){return null===e.href||e.href.startsWith(window.location.origin)}).reduce(function(e,t){return[...e,...Array.from(t.cssRules).reduce(function(e,t){return":root"===t.selectorText?[...e,...Array.from(t.style).filter(function(e){return e.startsWith("--")})]:e},[])]},[]).map(function(e){return e.replace(/^--color-/,"")})}function getCustomColors(e){const t={};return(e||getCustomColorNames()).forEach(function(e){t[e]=getCustomColor(e)}),t}function setCustomColors(s,e){const r={},n=!(!1===e||!timerAPI)&&{setTimerColors:{}};let a=!1;return Object.keys(s).forEach(function(e){var t=s[e],o=setCustomColor(e,t,!1);o&&(r[e]=o,n)&&(n.setTimerColors[e]=t,a=!0)}),a&&timerAPI.send(n),r}function getCustomColor(e){return window.getComputedStyle(document.documentElement).getPropertyValue("--color-"+e)}