/*!
 * timer.js
 * Copyright(c) 2023 Jonathan Annett
 * MIT Licensed
 */
const oneSecond=1e3,oneMinute=60*oneSecond,skip_granularity=15*oneSecond;var timerWin;window.opener&&0<=["timer_control_window","remote_timer_window"].indexOf(window.name)||"https:"===window.location.protocol?console.log("page load mode confirmed",document.referrer,location.origin):location.replace(location.origin),window.addEventListener("unload",onControlUnload);let doc=document,qs=doc.querySelector.bind(doc),getEl=doc.getElementById.bind(doc),tabCount=1,shifting=!1,controlling=!1,nudgeFactor=controlling?6e4:1e3,endDelta=controlling?6e4:0,seekEndDelta=controlling?6e4:1e3,stylesheet1=getEl("style_1"),stylesheet1_obj;replaceStylesheet(stylesheet1,function(e){stylesheet1_obj=e});let aceScript,elapsedDisp=getEl("elapsed_disp"),remainDisp=getEl("remain_disp"),startedDisp=getEl("started_disp"),endsDisp=getEl("ends_disp"),remainInfoDisp=getEl("remain_info_message"),custom_message=getEl("custom_message"),durationDisp=getEl("duration_disp"),extraTimeDisp=getEl("extra_time_disp"),nowDisp=getEl("now_disp"),keyDisp=getEl("key_disp"),dispNextMins=getEl("disp_next_mins"),html=qs("html"),progress=qs(".progress"),pausedAt,pauseAcum=0,runMode="controller",togglePIPMode,defaultDuration=(window.location.search.startsWith("?presenter")?(html.classList.add("reduced"),runMode="presenter",fs_api.isFullscreen()?document.title="Presentation Timer - Remote Screen (Fullscreen)":document.title="Presentation Timer - Remote Screen"):(fs_api.isFullscreen()?document.title="Presentation Timer - Control Screen (Fullscreen)":document.title="Presentation Timer - Control Screen",(togglePIPMode=setupPip("remain_disp","remain_disp_video",384,216,'100px "Lucida", sans-serif',"#remain_disp_video_text","overlay","#remain_disp_video_text",'40px "Lucida", sans-serif'))||setHtmlClass("nooverlay")),readNumber("defaultDuration",10*oneMinute)),thisDuration=defaultDuration,startedAt=readNumber("startedAt",Date.now()),endsAt=readNumber("endsAt",startedAt+defaultDuration),seekEndsAt=readNumber("seekEndsAt",endsAt),lastUpdateTick=0,lastTimeText="",lastEndsAtText="",enterTimeText="",enterHoursText="",restartNeeded=(window.tab_id="tab_"+Date.now().toString(),custom_message.addEventListener("focus",function(){setTimeout(function(){document.execCommand("selectAll",!1,null)},2)}),progress.style.width="0%",dispNextMins.textContent=secToStr(defaultDuration/1e3),isNaN(startedAt)||isNaN(endsAt));if(!restartNeeded){let e=6e5;(Date.now()>endsAt+e||Date.now()>seekEndsAt+e)&&(restartNeeded=!0)}function keyMacroClick(t){if("mouse"!==t.pointerType||0===t.button){let e=this.dataset.keys.split(",").map(function(e){return e.startsWith("!")?{key:e.substr(1),__up:!0}:{key:e}});if(t.shiftKey&&" "===e[0].key){if(""!==enterTimeText)return this.dataset.keys=" ,"+enterTimeText.split("").join(",")+", ",this.innerHTML=enterTimeText,clearHtmlClass("editing"),dispNextMins.textContent=secToStr(defaultDuration/1e3),void(enterTimeText="");e=this.dataset.keys.split(",").map(function(e){return" "===e?{key:"Enter"}:{key:e}})}e.forEach(function(e){(e.__up?onDocKeyUp:onDocKeyDown)(e)})}}function openTimerWindow(e){return!0===e?(timerWin&&timerWin.close(),window.opener&&window.close(),timerWin=void 0):(timerWin=open("timer.html?presenter","remote_timer_window","location=0"))&&timerWin.addEventListener("load",function(){console.log("timer win loaded"),timerWin.addEventListener("unload",onTimerWinUnload)}),!1}function displayUpdate(){var o=Date.now(),a=(tabCount=getTabCount(),getTabCount(!0));let r=!1,i=!1,l=!1,d="0",c;if((1===tabCount?clearHtmlClass:setHtmlClass)("twoplus"),fs_api.isFullscreen()?"presenter"===runMode?document.title="Presentation Timer - Remote Screen (Fullscreen)":"controller"===runMode?document.title="Presentation Timer - Control Screen (Fullscreen)":document.title="Presentation Timer (Fullscreen)":"presenter"===runMode?1===tabCount?document.title="Presentation Timer - Single Window":document.title="Presentation Timer - Remote Screen":"controller"===runMode?document.title="Presentation Timer - Control Screen":document.title="Presentation Timer","controller"===runMode||1===tabCount){var t=pausedAt?o-pausedAt:0;let e=(seekEndsAt-o)/oneSecond;0<e&&e++,c=secToStr(e),seekEndsAt<endsAt-500?(seekEndsAt,endsAt,skip_granularity,endsAt-=25,clearRemainClass("adjustingDown"),setRemainClass("adjusting"),d=Number((endsAt-seekEndsAt)/oneSecond).toFixed(1),keyDisp.textContent="speeding up to match actual time ("+c+")  "+d+" seconds offset",writeNumber("endsAt",endsAt),l=!0):seekEndsAt>endsAt+500?(seekEndsAt,endsAt,skip_granularity,endsAt+=25,clearRemainClass("adjusting"),setRemainClass("adjustingDown"),d=Number((endsAt-seekEndsAt)/oneSecond).toFixed(1),keyDisp.textContent="slowing down to match actual time ("+c+")  "+d+" seconds offset",writeNumber("endsAt",endsAt),i=!0):(endsAt=seekEndsAt,clearRemainClass("adjusting"),clearRemainClass("adjustingDown"),c=void 0,keyDisp.textContent=1===tabCount?"":1<a?"MULTIPLE CONTROLLERS TABS ARE OPEN. CLOSE ONE!":0==t?"remote display active":"countdown was paused at "+local24HourTime(new Date(pausedAt)),writeNumber("endsAt",endsAt));var u,a=(endsAt-o+t)/oneSecond;let s,n;0!=t?(m=secToStr(t/oneSecond),remainInfoDisp.textContent="presenter"===runMode?"Paused":m,endsDisp.textContent=local24HourTime(new Date(seekEndsAt+t)),u=secToStr((pauseAcum+t)/oneSecond),extraTimeDisp.textContent="+ "+u+" pauses",r=!0,timerAPI&&lastEndsAtText!==endsDisp.textContent&&(lastEndsAtText=endsDisp.textContent,timerAPI.send({setVariableValues:{adjusting_up:l,adjusting_down:i,adjusting_delta:d,remain_actual:c,endsAt:lastEndsAtText,paused:m,pauses:u,pausing:r}}))):(remainInfoDisp.textContent="",0===pauseAcum?extraTimeDisp.textContent="":extraTimeDisp.textContent="+ "+secToStr(pauseAcum/oneSecond)+" pauses");var m=o-startedAt-(t+pauseAcum);if(m<0?(setHtmlClass("future"),(-6e4<m?setHtmlClass:clearHtmlClass)("impending"),seekEndsAt=startedAt+thisDuration,bumpEnd(0,0),endsAt=seekEndsAt,n=secToStr((0-m)/oneSecond),elapsedDisp.textContent=n,s=secToStr(thisDuration/1e3),localStorage.setItem("elapsedDisp",n)):(clearHtmlClass("future"),s=secToStr(0<=a?1+a:0-a),n=secToStr(m/oneSecond)),lastTimeText!==s&&(0===lastUpdateTick||750<o-lastUpdateTick)){lastUpdateTick=o,remainDisp.textContent=s,elapsedDisp.textContent=n,lastTimeText=s;let e=!1,t=!1;0<=a?(clearHtmlClass("over"),0<=m&&(a<=60?(setHtmlClass("impending"),t=!0):clearHtmlClass("impending")),setBar(m,thisDuration)):(e=!0,setHtmlClass("over"),clearHtmlClass("impending"),setBarPct(100)),localStorage.setItem("remainDisp",s),timerAPI&&timerAPI.send({setVariableValues:{adjusting_up:l,adjusting_down:i,adjusting_delta:d,remain_actual:c||s,expired:e,impending:t,pausing:r,remain:s,elapsed:n}})}localStorage.setItem("remainDispClass",html.className)}else keyDisp.textContent=tabCount+" tabs open";nowDisp.textContent=timeNowStr()}function updateEnteredTimeText(){""===enterHoursText?dispNextMins.textContent=secToStr(60*Number(enterTimeText)):dispNextMins.textContent=secToStr(3600*Number(enterHoursText)+60*Number(enterTimeText))}function replaceStylesheet(o,a){var e=o.href;let s=new XMLHttpRequest,r;s.responseType="text",s.open("GET",e),s.onreadystatechange=function(){if(4==s.readyState){r=this.responseText;let e,s,n=document.createElement("style");n.innerHTML=r;var t=localStorage.getItem("custom_css");t&&(n.innerHTML=t),document.body.appendChild(n),o.parentNode.removeChild(o),a&&a(Object.defineProperties({},{sheet:{value:n},css:{set:function(e){n.innerHTML=e},get:function(){return n.innerHTML}},reset:{value:function(){n.innerHTML=r,localStorage.removeItem("custom_css")}},editToggle:{value:function(){if(e)n.innerHTML=e.getValue(),localStorage.setItem("custom_css",n.innerHTML),s.parentNode.removeChild(s),e=void 0;else{let t=function(){(s=document.createElement("pre")).id="css_editor",document.body.appendChild(s),setTimeout(function(){(e=ace.edit("css_editor")).setTheme("ace/theme/chrome"),e.session.setMode("ace/mode/css"),e.setValue(n.innerHTML),e.focus(),e.gotoLine(1)},10)};if(aceScript){let e=setInterval(function(){window.ace&&(clearInterval(e),t())},100)}else{(aceScript=document.createElement("script")).setAttribute("integrity","sha512-NSbvq6xPdfFIa2wwSh8vtsPL7AyYAYRAUWRDCqFH34kYIjQ4M7H2POiULf3CH11TRcq3Ww6FZDdLZ8msYhMxjg=="),aceScript.setAttribute("crossorigin","anonymous"),aceScript.setAttribute("referrerpolicy","no-referrer"),aceScript.setAttribute("src","https://cdnjs.cloudflare.com/ajax/libs/ace/1.15.2/ace.js"),document.body.appendChild(aceScript);let e=setInterval(function(){window.ace&&(clearInterval(e),t())},100)}}}},editing:{get:function(){return!!e}}}))}},s.send()}function restartTimer(e){thisDuration=void 0===e?defaultDuration:e,lastUpdateTick=0,startedAt=Date.now(),endsAt=startedAt+thisDuration,pausedAt=void 0,pauseAcum=0,seekEndsAt=endsAt,startedDisp.textContent=local24HourTime(new Date(startedAt)),endsDisp.textContent=local24HourTime(new Date(endsAt)),durationDisp.textContent=secToStr(thisDuration/1e3),extraTimeDisp.textContent="",writeNumber("pausedAt",pausedAt),writeNumber("pauseAcum",pauseAcum),writeNumber("startedAt",startedAt),writeNumber("endsAt",endsAt),writeNumber("seekEndsAt",seekEndsAt),clearHtmlClass("countup-override"),clearHtmlClass("paused"),setBarPct(0),timerAPI&&timerAPI.send({setVariableValues:{startedAt:startedDisp.textContent,endsAt:endsDisp.textContent,default:durationDisp.textContent,paused:"0:00",pauses:"0:00",pausing:!1,expired:!1,showpresenter:html.classList.contains("reduced")?"1":"0",impending:thisDuration<=6e4}})}function setPresenterMode(){runMode="presenter",html.classList.add("reduced"),timerAPI&&timerAPI.send({setVariableValues:{showpresenter:"1"}})}function setControllerMode(){runMode="controller",html.classList.remove("reduced"),timerAPI&&timerAPI.send({setVariableValues:{showpresenter:"0"}})}function extendDefaultToCurrentTimer(){lastUpdateTick=0,endsAt=startedAt+defaultDuration,thisDuration=defaultDuration,writeNumber("endsAt",seekEndsAt=endsAt),writeNumber("seekEndsAt",seekEndsAt),durationDisp.textContent=secToStr(defaultDuration/1e3),displayUpdate()}function onLocalStorage(e){var t;"presenter"!==runMode||"showbar"!==e.key&&!e.key.startsWith("remainDisp")||(remainDisp.textContent=localStorage.getItem("remainDisp"),html.className=localStorage.getItem("remainDispClass")+" reduced",1===readNumber("showbar",0)?(setHtmlClass("showbar"),setBarPct(Number(localStorage.getItem("barpct")))):clearHtmlClass("showbar")),"elapsedDisp"===e.key&&(elapsedDisp.textContent=localStorage.getItem("elapsedDisp")),"showtimenow"===e.key&&(1===readNumber("showtimenow",0)?setHtmlClass:clearHtmlClass)("showtimenow"),"showmessages"===e.key&&(1===readNumber("showmessages",0)?setHtmlClass:clearHtmlClass)("showmessages"),"custom_message"===e.key&&(t=localStorage.getItem("custom_message"),(""===(custom_message.textContent=t)?clearHtmlClass:setHtmlClass)("show_custom_message")),stylesheet1_obj&&!stylesheet1_obj.editing&&"custom_css"===e.key&&((t=localStorage.getItem("custom_css"))?stylesheet1_obj.css=t:stylesheet1_obj.reset())}function getTabCount(t){var s=[];let n=1,e=Date.now(),o=e-3e3;t||(writeNumber(tab_id,e),"controller"===runMode?writeNumber("controller_"+tab_id,e):localStorage.removeItem("controller_"+tab_id));for(let e=0;e<localStorage.length;e++){var a=localStorage.key(e);a!==tab_id&&a.startsWith("tab_")?Number(localStorage.getItem(a))<o?s.push(a):(!t||0<readNumber("controller_"+a,0))&&n++:a.startsWith("controller_tab_")&&Number(localStorage.getItem(a))<o&&s.push(a)}return s.forEach(function(e){localStorage.removeItem(e)}),n}restartNeeded?restartTimer():((Date.now()>endsAt||Date.now()>seekEndsAt)&&(endsAt=seekEndsAt,setHtmlClass("over")),startedDisp.textContent=local24HourTime(new Date(startedAt)),endsDisp.textContent=local24HourTime(new Date(endsAt)),durationDisp.textContent=secToStr((endsAt-startedAt)/1e3),pausedAt=readNumber("pausedAt",pausedAt),pauseAcum=readNumber("pauseAcum",pauseAcum),void 0!==pausedAt&&setHtmlClass("paused"),displayUpdate(),(1===readNumber("showbar",0)?setHtmlClass:clearHtmlClass)("showbar"),(1===readNumber("showtimenow",0)?setHtmlClass:clearHtmlClass)("showtimenow"),(1===readNumber("showmessages",0)?setHtmlClass:clearHtmlClass)("showmessages"),localStorage.setItem("remainDispClass",html.className)),dispNextMins.textContent=secToStr(defaultDuration/oneSecond),setInterval(displayUpdate,100),doc.addEventListener("keyup",onDocKeyUp),doc.addEventListener("keydown",onDocKeyDown),doc.addEventListener("contextmenu",function(e){e.preventDefault()}),addEventListener("storage",onLocalStorage),[].forEach.call(document.querySelectorAll("div.buttons div.btn"),function(e){e.addEventListener("pointerdown",keyMacroClick)});let custom_msg_timeout;function onKey_Pause(e){var t,s=Date.now();html.classList.toggle("paused"),lastTimeText="",togglePIPMode&&(togglePIPMode.lastContent=""),html.classList.contains("paused")?(writeNumber("pausedAt",pausedAt=Date.now()),endsAt=seekEndsAt,t=secToStr(pauseAcum/oneSecond),extraTimeDisp.textContent="+ "+t+" pauses",timerAPI&&timerAPI.send({setVariableValues:{default:secToStr(defaultDuration/1e3),pausing:!0,pauses:t,paused:"0:00"}})):(t=pausedAt?s-pausedAt:0,pausedAt=void 0,seekEndsAt+=t,pauseAcum+=t,writeNumber("pausedAt",pausedAt),writeNumber("pauseAcum",pauseAcum),s=secToStr(pauseAcum/oneSecond),extraTimeDisp.textContent="+ "+s+" pauses",endsAt=seekEndsAt,endsDisp.textContent=local24HourTime(new Date(seekEndsAt)),timerAPI&&timerAPI.send({setVariableValues:{default:secToStr(defaultDuration/1e3),endsAt:endsDisp.textContent,pausing:!1,pauses:s,paused:"0:00"}}))}function onKey_UndoPause(e){clearHtmlClass("paused"),pausedAt=void 0,pauseAcum=0,writeNumber("pausedAt",pausedAt),writeNumber("pauseAcum",pauseAcum),extraTimeDisp.textContent="",seekEndsAt=startedAt+thisDuration,endsAt=seekEndsAt,endsDisp.textContent=local24HourTime(new Date(seekEndsAt)),timerAPI&&timerAPI.send({setVariableValues:{endsAt:endsDisp.textContent,pauses:"0:00",paused:"0:00"}})}function onKey_ArrowDown(e){bumpEnd(0-seekEndDelta,0-endDelta),durationDisp.textContent=secToStr((seekEndsAt-startedAt)/1e3),displayUpdate()}function onKey_Shift_ArrowDown(e){bumpStart(nudgeFactor),durationDisp.textContent=secToStr((seekEndsAt-startedAt)/1e3),displayUpdate()}function onKey_ArrowUp(e){bumpEnd(seekEndDelta,endDelta),durationDisp.textContent=secToStr((seekEndsAt-startedAt)/1e3),displayUpdate()}function onKey_Shift_ArrowUp(e){bumpStart(0-nudgeFactor),durationDisp.textContent=secToStr((seekEndsAt-startedAt)/1e3),displayUpdate()}function onKey_ArrowLeft(e){bumpStart(0-nudgeFactor),bumpEnd(0-seekEndDelta,0-endDelta),durationDisp.textContent=secToStr((seekEndsAt-startedAt)/1e3),displayUpdate()}function onKey_ArrowRight(e){bumpStart(nudgeFactor),bumpEnd(seekEndDelta,endDelta),durationDisp.textContent=secToStr((seekEndsAt-startedAt)/1e3),displayUpdate()}function onKey_Ctrl_Q(e){is_nwjs()&&require("nw.gui").App.quit()}function onKey_Space(e){var t=defaultDuration;saveEditedTime(),restartTimer(),defaultDuration!==t&&(defaultDuration=t,dispNextMins.textContent=secToStr(defaultDuration/1e3),clearHtmlClass("editing"),writeNumber("defaultDuration",defaultDuration))}function onKey_Shift_Space(e){var t=defaultDuration;saveEditedTime(),extendDefaultToCurrentTimer(),defaultDuration!==t&&(defaultDuration=t,dispNextMins.textContent=secToStr(defaultDuration/1e3),clearHtmlClass("editing"),writeNumber("defaultDuration",defaultDuration))}function onKey_Control_Space(e){defaultDuration;lastUpdateTick=0,endsAt=seekEndsAt,clearRemainClass("adjusting"),clearRemainClass("adjustingDown"),keyDisp.textContent=tabCount+" tabs open",lastTimeText="",writeNumber("endsAt",endsAt)}function onKey_M(e){html.classList.toggle("showmessages"),writeNumber("showmessages",html.classList.contains("showmessages")?1:0),togglePIPMode&&(togglePIPMode.lastContent=""),lastTimeText=""}function onKey_B(e){var t=html.classList.contains("showbar")?0:1;html.classList.toggle("showbar"),writeNumber("showbar",t)}function onKey_T(e){var t=html.classList.contains("showtimenow")?0:1;html.classList.toggle("showtimenow"),writeNumber("showtimenow",t)}function onKey_O(e){togglePIPMode&&togglePIPMode()}function onKey_P(e){var t;"?presenter"!==window.location.search&&1===tabCount&&(html.classList.toggle("reduced"),t=html.classList.contains("reduced"),runMode=t?"presenter":"controller",timerAPI)&&timerAPI.send({setVariableValues:{showpresenter:t?"1":"0"}}),html.classList[html.classList.contains("reduced")?"remove":"add"]("showbuttons")}function onKey_S(e){"?presenter"!==window.location.search&&1===tabCount&&(html.classList.add("reduced"),html.classList.add("showbuttons"),runMode="presenter",fs_api.isFullscreen()||fs_api.enterFullscreen(),timerAPI)&&timerAPI.send({setVariableValues:{showpresenter:"1"}})}function onKey_Control_S(e){stylesheet1_obj&&stylesheet1_obj.editToggle(),e.preventDefault()}function onKey_Control_Shift_S(e){stylesheet1_obj&&(stylesheet1_obj.reset(),stylesheet1_obj.editing)&&stylesheet1_obj.editToggle(),e.preventDefault()}function onKey_X(e){extendDefaultToCurrentTimer()}function onKey_C(e){html.classList.add("edit_custom_message"),html.classList.remove("show_custom_message"),custom_message.innerText="custom message",custom_message.contentEditable=!0,custom_message.focus(),e.preventDefault()}function onKey_R(e){controlling||(e.preventDefault(),isSingleScreenMode())||"presenter"===runMode&&1===tabCount||openTimerWindow(1<tabCount)}function onDocKeyDown(e){function t(){controlling=e.ctrlKey,html.classList[controlling?"add":"remove"]("controlling"),shifting=e.shiftKey,html.classList[shifting?"add":"remove"]("shifting")}if(html.classList.contains("edit_custom_message"))return"Enter"===e.key&&(custom_message.contentEditable=!1,html.classList.remove("edit_custom_message"),"custom message"===custom_message.textContent?(html.classList.remove("show_custom_message"),localStorage.setItem("custom_message","")):(html.classList.add("show_custom_message"),custom_msg_timeout=setTimeout(function(){custom_msg_timeout=void 0,localStorage.setItem("custom_message",custom_message.textContent)},500))),t();if(html.classList.contains("show_custom_message")&&("c"===e.key||"C"===e.key))return html.classList.remove("edit_custom_message"),html.classList.remove("show_custom_message"),custom_msg_timeout&&(clearTimeout(custom_msg_timeout),custom_msg_timeout=void 0),localStorage.setItem("custom_message",""),t();if(stylesheet1_obj&&stylesheet1_obj.editing)return"S"!==e.key&&"s"!==e.key||!e.ctrlKey||(e.preventDefault(),stylesheet1_obj.editToggle(),e.shiftKey&&stylesheet1_obj.reset()),t();if(tabCount=getTabCount(),nudgeFactor=controlling?6e4:1e3,endDelta=controlling?6e4:0,seekEndDelta=controlling?6e4:1e3,"string"==typeof e.key&&(1<=e.key&&e.key<=9||"0"===e.key))enterTimeText=enterTimeText+""+e.key,setHtmlClass("editing"),updateEnteredTimeText();else switch(e.key){case"/":case'"':return onKey_Pause(e);case"Tab":case"'":return onKey_UndoPause(e);case".":""!==enterTimeText&&enterTimeText.indexOf(".")<0&&(enterTimeText+=e.key,setHtmlClass("editing"),updateEnteredTimeText());break;case":":""===enterHoursText&&(enterHoursText=enterTimeText,enterTimeText="",setHtmlClass("editing"),dispNextMins.textContent=secToStr(3600*Number(enterHoursText)+60*Number(enterTimeText)));break;case"Backspace":""!==enterTimeText?(enterTimeText=enterTimeText.substr(0,enterTimeText.length-1),updateEnteredTimeText()):(clearHtmlClass("editing"),dispNextMins.textContent=secToStr(defaultDuration/1e3));break;case"Enter":controlling?(lastUpdateTick=0,endsAt=seekEndsAt,clearRemainClass("adjusting"),clearRemainClass("adjustingDown"),keyDisp.textContent=tabCount+" tabs open",writeNumber("endsAt",endsAt)):saveEditedTime();break;case"q":case"Q":controlling&&onKey_Ctrl_Q(e);break;case"ArrowDown":html.classList.contains("editing")||(shifting?onKey_Shift_ArrowDown:onKey_ArrowDown)(e);break;case"ArrowUp":html.classList.contains("editing")||(shifting?onKey_Shift_ArrowUp:onKey_ArrowUp)(e);break;case"ArrowLeft":html.classList.contains("editing")||onKey_ArrowLeft(e);break;case"ArrowRight":html.classList.contains("editing")||onKey_ArrowRight(e);break;case"Shift":shifting=!0,setHtmlClass("shifting");break;case"Control":controlling=!0,setHtmlClass("controlling");break;case"i":case"I":controlling&&shifting;break;case"F":case"f":controlling||(fs_api.isFullscreen()?fs_api.exitFullscreen():fs_api.enterFullscreen());break;case"b":case"B":controlling||onKey_B(e);break;case"*":case" ":(controlling?onKey_Control_Space:shifting?onKey_Shift_Space:onKey_Space)(e);break;case"m":case"M":controlling||onKey_M(e);break;case"t":case"T":controlling||onKey_T(e);break;case"o":case"O":controlling||onKey_O(e);break;case"p":case"P":controlling||onKey_P(e);break;case"s":case"S":(controlling?shifting?onKey_Control_Shift_S:onKey_Control_S:onKey_S)(e);break;case"x":case"X":controlling||onKey_X(e);break;case"c":case"C":controlling||onKey_C(e);break;case"R":case"r":controlling||onKey_R(e)}}function isSingleScreenMode(){return!window.location.search.startsWith("?presenter")&&html.classList.contains("reduced")&&html.classList.contains("showbuttons")&&"presenter"===runMode}function setDefaultDuration(e){defaultDuration=e,Date.now()-startedAt<0&&(thisDuration=defaultDuration),enterTimeText="",enterHoursText="",dispNextMins.textContent=secToStr(defaultDuration/1e3),clearHtmlClass("editing"),writeNumber("defaultDuration",defaultDuration)}function saveEditedTime(){""!==enterTimeText&&""!==enterTimeText&&(setDefaultDuration(1e3*(3600*Number(enterHoursText)+60*Number(enterTimeText))),timerAPI)&&timerAPI.send({setVariableValues:{default:dispNextMins.textContent}})}function onDocKeyUp(e){controlling=e.ctrlKey,html.classList[controlling?"add":"remove"]("controlling"),shifting=e.shiftKey,html.classList[shifting?"add":"remove"]("shifting")}function bumpStart(e){startedAt+=e,startedDisp.textContent=local24HourTime(new Date(startedAt)),writeNumber("startedAt",startedAt),lastTimeText="",timerAPI&&timerAPI.send({setVariableValues:{startedAt:startedDisp.textContent}})}function bumpEnd(e,t){seekEndsAt+=e,endsAt+=t,thisDuration=seekEndsAt-startedAt,endsDisp.textContent=local24HourTime(new Date(seekEndsAt)),writeNumber("seekEndsAt",seekEndsAt),lastTimeText="",timerAPI&&timerAPI.send({setVariableValues:{endsAt:endsDisp.textContent}})}function setBarPct(e){progress.style.width=e+"%",localStorage.setItem("barpct",e.toString())}function setBar(e,t){setBarPct(Math.floor(e/t*100))}function readNumber(e,t){e=localStorage.getItem(e);return e?Number(e):t}function writeNumber(e,t){var s;void 0===t?localStorage.removeItem(e):localStorage.setItem(e,t.toString()),timerAPI&&0<=["showtimenow","showmessages","showbar"].indexOf(e)&&((s={})[e]=t.toString()||"0",timerAPI.send({setVariableValues:s}))}function secToStr(e){var t=e<0?"-":"",s=(e<0&&(e=0-e),Math.trunc(e/60)%60),n=Math.trunc(e/3600),e=Math.trunc(e%60),e=(e<10?"0":"")+e.toString();return n<1?t+s.toString()+":"+e:(s=(s<10?"0":"")+s.toString(),t+n.toString()+":"+s+":"+e)}function local24HourTime(e){e=e.toString().split(":");return e[0]=e[0].split(" ").pop(),e[2]=e[2].split(" ")[0],e.join(":")}function timeNowStr(){return local24HourTime(new Date)}function setRemainClass(e){remainDisp.classList.contains(e)||remainDisp.classList.add(e)}function clearRemainClass(e){remainDisp.classList.contains(e)&&remainDisp.classList.remove(e)}function toggleRemainClass(e){remainDisp.classList.toggle(e)}function setHtmlClass(e){html.classList.contains(e)||html.classList.add(e)}function clearHtmlClass(e){html.classList.contains(e)&&html.classList.remove(e)}function onTimerWinUnload(){localStorage.removeItem(timerWin.tab_id),timerWin=void 0}function onControlUnload(){timerWin&&(timerWin.close(),timerWin=void 0),localStorage.removeItem(tab_id),localStorage.removeItem("controller_"+tab_id)}function is_nwjs(){try{return void 0!==require("nw.gui")}catch(e){return!1}}"presenter"===runMode||"http:"!==location.protocol||location.hostname.endsWith(".com")||"function"!=typeof startTimerApi||startTimerApi();